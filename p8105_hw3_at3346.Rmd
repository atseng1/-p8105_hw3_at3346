---
title: "p8105_hw3_at3346"
author: "Ashley Tseng"
date: "10/14/2019"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)
library(ggplot2)
library(viridis)
library(readxl)
library(formattable)
library(data.table)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

## Problem 1

Load data:
```{r problem 1.1}
data("instacart") 

n_aisle = instacart %>% 
  count(aisle) %>% 
  View
```
The `instacart` dataset contains `r nrow(instacart)` observations (representing products from orders) of 131,209 unique users and `r ncol(instacart)` variables. There is a single order per user in this dataset. Key variables in the `instacart` dataset include `reordered`, which describes if this product has been ordered by this user in the past,`order_dow`, which describes the day of the week on which the order was placed, and
`order_hour_of_day`, which describes the hour of the day on which the order was placed. 

There are 134 aisles. The aisles that the most items are ordered from are "fresh vegetables" (150,609 orders) and "fresh fruit" (150,473 orders).

```{r prob1.plot1}
n_ordered = n_aisle %>% 
  filter(n > 10000) %>% 
  ggplot(aes(x = aisle, y = n, color = aisle)) +
  geom_point() +
  labs(
    title = "Number of items ordered in each aisle",
    x = "Aisle name",
    y = "Number of items ordered") +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1),
    legend.position = "none")

n_ordered
```
DONE

```{r prob1.table1}
table_popitems = instacart %>% 
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits")
  
popitems = data.table(table_popitems, key=c("product_name"))
popitems[, tail(.SD, 3), by = product_name] 


  tail(names(sort(table("product_name"))), 1) %>% 
  
  group_by(aisle, product_name) %>%
  summarize(n_timesord = round(count(product_name), digits = 2)) %>%
  pivot_wider(
    names_from = product_name,
    values_from = n_timesord
  ) %>% 
  knitr::kable()
```
NOT DONE

```{r table2}
table_meanhr = instacart %>% 
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") %>% 
  mutate(
    order_dow = recode(order_dow, "0" = "Saturday", "1" = "Sunday", "2" = "Monday", "3" = "Tuesday", 
                       "4" = "Wednesday", "5" = "Thursday", "6" = "Friday"),
    order_dow = ordered(order_dow, c("Saturday", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday"))                   
    ) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(mean_hrordered = round(mean(order_hour_of_day), digits = 2)) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hrordered
  ) %>% 
  knitr::kable()
```
DONE

## Problem 2

Data cleaning:
```{r problem2.1}
data("brfss_smart2010") 

brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(
    topic == "Overall Health",
    response == "Excellent" | response == "Very good" | response == "Good" | response == "Fair" | response == "Poor"
    ) %>% 
  mutate(
    response = ordered(response, c("Poor", "Fair", "Good", "Very good", "Excellent"))
  ) %>% 
  View
```
DONE

In 2002, which states were observed at 7 or more locations? What about in 2010?
```{r problem2.2}
brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(
    topic == "Overall Health",
    response == "Excellent" | response == "Very good" | response == "Good" | response == "Fair" | response == "Poor",
    year == "2002"
    ) %>% 
  mutate(
    response = ordered(response, c("Poor", "Fair", "Good", "Very good", "Excellent"))
  ) %>% 
  pivot_wider(
    names_from = locationdesc,
    values_from = childs_first_name
    ) %>% 
  View


  separate(locationdesc, into = c("state", "county"), sep="-") %>% 
  select(-c("state")) %>% 
  View
  group_by(locationabbr, county) %>% 
  count(locationabbr) %>%
  View
```
NOT DONE


## Problem 3

Load, tidy, and wrangle data:
```{r problem3.1}
accel_data = 
  read_csv("./data/accel_data.csv", col_names = TRUE) %>%
  janitor::clean_names() %>%
  mutate(
    weekend = recode(day, "Saturday" = 1, "Sunday" = 1, "Monday" = 0, "Tuesday" = 0, "Wednesday" = 0, "Thursday" = 0, "Friday" = 0),
    weekday = recode(day, "Saturday" = 0, "Sunday" = 0, "Monday" = 1, "Tuesday" = 1, "Wednesday" = 1, "Thursday" = 1, "Friday" = 1)
         ) %>% 
  select(week, day_id, day, weekend, weekday, everything()) %>% 
  pivot_longer(
    cols = starts_with("activity_"),
    names_to = "activity_number",
    names_prefix = "activity_",
    values_to = "act_count_min"
  )
```
The `accel_data` dataset contains `r nrow(accel_data)` observations and `r ncol(accel_data)` variables. The `r ncol(accel_data)` variables in the dataset are `week`, `day_id`, `day`, `weekend`, `weekday`, `activity_number`, and `act_count_min`.

DONE?


```{r prob3.table1}
tot_act = 
  accel_data %>% 
   mutate(
    day = ordered(day, c("Saturday", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday")),
    week = ordered(week, c("1", "2", "3", "4", "5"))
    ) %>% 
  group_by(week, day_id, day) %>% 
  summarize (total_min = sum(act_count_min)) %>%
  View
  knitr::kable()


tot_act %>% 
  ggplot(aes(x = day, y = total_min, color = week)) + 
  geom_point() +
  facet_grid(~week)
```
NOT DONE


```{r prob3.plot1}
accel_data %>% 
  ggplot(aes(x = , y = )) + 
  geom_point() +
  geom_line()
```
NOT DONE
